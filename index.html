<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.11/firebase-app.js";
  import { getDatabase, ref, query, limitToLast, onValue } 
    from "https://www.gstatic.com/firebasejs/9.6.11/firebase-database.js";

  // Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyDcAn84EYf0U26ubggBl5TOHkEFzHTiVnM",
    authDomain: "geoai-flood-control.firebaseapp.com",
    databaseURL: "https://geoai-flood-control-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "geoai-flood-control",
    storageBucket: "geoai-flood-control.firebasestorage.app",
    messagingSenderId: "290912556912",
    appId: "1:290912556912:web:a87b7886ea55f3b265a1b5"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  // ------------------------------------------
  // ðŸ”µ REALTIME LATEST VALUE
  // ------------------------------------------
  const latestQuery = query(ref(db, "flood-data/records"), limitToLast(1));
  onValue(latestQuery, snapshot => {
    snapshot.forEach(child => {
      const data = child.val();

      document.getElementById("level").innerHTML = data.level + " cm";

      let date = new Date(data.timestamp * 1000);
      document.getElementById("time").innerHTML = date.toLocaleString();
    });
  });

  // ------------------------------------------
  // ðŸŸ¢ TABLE RECORDS (20 latest)
  // ------------------------------------------
  const tableQuery = query(ref(db, "flood-data/records"), limitToLast(20));
  onValue(tableQuery, snapshot => {
    let table = document.getElementById("dataTable");
    table.innerHTML = `
      <tr>
        <th>Timestamp</th>
        <th>Level (cm)</th>
      </tr>
    `;

    snapshot.forEach(child => {
      const data = child.val();
      let date = new Date(data.timestamp * 1000);

      table.innerHTML += `
        <tr>
          <td>${date.toLocaleString()}</td>
          <td>${data.level} cm</td>
        </tr>
      `;
    });
  });
</script>
